<turbo-stream target="anilist" action="update">
  <template>
    <% if @error || !@success %>
      <%= render partial: "anilist/new", formats: [:html] %>

      <% if @error %>
        <script>
          Alpine.store("toasts").createToast("<%= sanitize @error %>", "error");
        </script>
      <% end %>
    <% else %>
      <div class="backdrop-blur-sm p6-4 flex flex-col flex-1 w-full py-4">
        <div class="dark:text-text--dark text-text--light max-w-sm mx-auto mb-6 font-sans text-3xl font-semibold text-center">
          <div class="pointer-events-auto">
            <span class="opacity-80">Take me</span>
            <%= link_to "Back", anilist_index_path, class: "hover:text-[#3DB4F2] border-b", target: "anilist" %>
          </div>
        </div>
        <div
          class="
            phone:grid-cols-1
            dark:[color-scheme:dark]
            phone:overflow-y-auto
            tablet:grid-cols-2
            tablet:overflow-y-auto
            desktop:grid-cols-4
            desktop:my-auto
            desktop:overflow-hidden
            justify-items-center
            container
            relative
            grid
            justify-between
            gap-5
            text-center
          "
        >
          <div
            class=" dark:bg-fg--dark bg-fg--light h-fit tablet:h-full w-full max-w-sm pb-5 border-b-4 border-blue-400 rounded-md pointer-events-auto"
          >
            <div class="bg-inherit sticky top-0 px-10 pt-5 mb-5">
              <h1
                class=" border-b-text--light dark:border-b-text--dark dark:text-text--dark text-text--light text-2xl font-bold border-b-2"
              >
                <%= sanitize "Not Following You (<span class='text-[#3DB4F2]'>#{(@following - @followers).size}</span>)" %>
              </h1>
            </div>
            <ul class="desktop:h-[70vh] dark:[color-scheme:dark] desktop:overflow-y-auto list-none mx-5">
              <% (@following - @followers).each do |f| %>
                <li class="hover:text-cyan-400 text-blue-400">
                  <%= link_to f, "https://anilist.co/user/#{f}", target: "_blank", rel: "noreferrer noopener" %>
                </li>
              <% end %>
            </ul>
          </div>

          <div
            class=" dark:bg-fg--dark bg-fg--light h-fit tablet:h-full w-full max-w-sm pb-5 border-b-4 border-blue-400 rounded-md pointer-events-auto"
          >
            <div class="bg-inherit sticky top-0 px-10 pt-5 mb-5">
              <h1
                class=" border-b-text--light dark:border-b-text--dark dark:text-text--dark text-text--light text-2xl font-bold border-b-2"
              >
                <%= sanitize "You're Not Following (<span class='text-[#3DB4F2]'>#{(@followers - @following).size}</span>)" %>
              </h1>
            </div>
            <ul class="desktop:h-[70vh] dark:[color-scheme:dark] desktop:overflow-y-auto list-none mx-5">
              <% (@followers - @following).each do |f| %>
                <li class="hover:text-cyan-400 text-blue-400">
                  <%= link_to f, "https://anilist.co/user/#{f}", target: "_blank", rel: "noreferrer noopener" %>
                </li>
              <% end %>
            </ul>
          </div>

          <div
            class=" dark:bg-fg--dark bg-fg--light h-fit tablet:h-full w-full max-w-sm pb-5 border-b-4 border-blue-400 rounded-md pointer-events-auto"
          >
            <div class="bg-inherit sticky top-0 px-10 pt-5 mb-5">
              <h1
                class=" border-b-text--light dark:border-b-text--dark dark:text-text--dark text-text--light text-2xl font-bold border-b-2"
              >
                <%= sanitize "Following (<span class='text-[#3DB4F2]'>#{@following_count}</span>)" %>
              </h1>
            </div>

            <ul class="desktop:h-[70vh] dark:[color-scheme:dark] desktop:overflow-y-auto list-none mx-5">
              <% @following.each do |f| %>
                <li class="hover:text-cyan-400 text-blue-400">
                  <%= link_to f, "https://anilist.co/user/#{f}", target: "_blank", rel: "noreferrer noopener" %>
                </li>
              <% end %>
            </ul>
          </div>

          <div
            class=" dark:bg-fg--dark bg-fg--light h-fit tablet:h-full w-full max-w-sm pb-5 border-b-4 border-blue-400 rounded-md pointer-events-auto"
          >
            <div class="bg-inherit sticky top-0 px-10 pt-5 mb-5">
              <h1
                class=" border-b-text--light dark:border-b-text--dark dark:text-text--dark text-text--light text-2xl font-bold border-b-2"
              >
                <%= sanitize "Followers (<span class='text-[#3DB4F2]'>#{@followers_count}</span>)" %>
              </h1>
            </div>

            <ul class="desktop:h-[70vh] dark:[color-scheme:dark] desktop:overflow-y-auto list-none mx-5">
              <% @followers.each do |f| %>
                <li class="hover:text-cyan-400 text-blue-400">
                  <%= link_to f, "https://anilist.co/user/#{f}", target: "_blank", rel: "noreferrer noopener" %>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    <% end %>
  </template>
</turbo-stream>
