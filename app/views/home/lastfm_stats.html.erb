<turbo-frame id="lastfm_stats">
  <div class="w-full h-full bg-center" style="background-image: url('<%= @album_art.present? ? image_url_to_base64(@album_art) : image_url_to_base64(vite_asset_url("images/lastfm-placeholder.webp")) %>')">
    <div class="w-full h-full backdrop-blur-sm backdrop-brightness-[40%] bg-gradient-to-tr from-cyan-700/30 to-pink-500/30 text-white flex flex-col items-stretch gap-5 px-4 py-4" x-data="">
      <button x-on:click="window.open('https://bit.ly/cyan-lastfm')" class="hover:underline text-lg font-bold text-left">
        <% if @lastfm_recent&.[]('nowplaying') %>
          LAST.FM (NOW PLAYING)
        <% else %>
          LAST.FM
        <% end %>
      </button>
      <div class="flex flex-col gap-2" x-data="">
        <button x-on:click="window.open('https://bit.ly/cyan-lastfm')" class="w-[150px] mx-auto">
          <img src="<%= @album_art.present? ? image_url_to_base64(@album_art) : image_url_to_base64(vite_asset_url("images/lastfm-placeholder.webp")) %>" alt="albumart">
        </button>
        <% if @lastfm_recent.present? %>
          <% if @lastfm_recent&.[]('nowplaying') %>
            <div id="equalizer">
              <div class="eq-bar-0 left-[-2px]"></div>
              <div class="eq-bar-1 left-[10px]"></div>
              <div class="eq-bar-2 left-[22px]"></div>
              <div class="eq-bar-3 left-[34px]"></div>
              <div class="eq-bar-4 left-[46px]"></div>
              <div class="eq-bar-5 left-[58px]"></div>
              <div class="eq-bar-6 left-[70px]"></div>
              <div class="eq-bar-7 left-[82px]"></div>
              <div class="eq-bar-8 left-[94px]"></div>
              <div class="eq-bar-9 left-[106px]"></div>
              <div class="eq-bar-10 left-[118px]"></div>
              <div class="eq-bar-11 left-[130px]"></div>
              <div class="eq-bar-12 left-[142px]"></div>
              <div class="eq-bar-13 left-[154px]"></div>
              <div class="eq-bar-14 left-[166px]"></div>
              <div class="eq-bar-15 left-[178px]"></div>
              <div class="eq-bar-16 left-[190px]"></div>
              <div class="eq-bar-17 left-[202px]"></div>
              <div class="eq-bar-18 left-[214px]"></div>
              <div class="eq-bar-19 left-[226px]"></div>
              <div class="eq-bar-20 left-[238px]"></div>
              <div class="eq-bar-21 left-[250px]"></div>
              <div class="eq-bar-22 left-[262px]"></div>
              <div class="eq-bar-23 left-[274px]"></div>
              <div class="eq-bar-24 left-[286px]"></div>
              <div class="eq-bar-25 left-[298px]"></div>
              <div class="eq-bar-26 left-[310px]"></div>
              <div class="eq-bar-27 left-[322px]"></div>
              <div class="eq-bar-28 left-[334px]"></div>
              <div class="eq-bar-29 left-[346px]"></div>
              <div class="eq-bar-30 left-[358px]"></div>
              <div class="eq-bar-31 left-[370px]"></div>
              <div class="eq-bar-32 left-[382px]"></div>
              <div class="eq-bar-33 left-[394px]"></div>
              <div class="eq-bar-34 left-[406px]"></div>
              <div class="eq-bar-35 left-[418px]"></div>
              <div class="eq-bar-36 left-[430px]"></div>
              <div class="eq-bar-37 left-[442px]"></div>
              <div class="eq-bar-38 left-[454px]"></div>
              <div class="eq-bar-39 left-[466px]"></div>
              <div class="eq-bar-40 left-[478px]"></div>
            </div>
          <% end %>
          <div class="flex flex-col text-center">
            <div class="text-[#3cb4f1] text-3xl font-bold line-clamp-2 break-words">
              <%= @lastfm_recent["name"] %>
            </div>
            <div x-on:click="window.open('<%= @lastfm_recent["artist"]["url"] %>')" class="line-clamp-1 hover:underline text-2xl cursor-pointer">
              <%= "#{@lastfm_recent['artist']['name'].upcase}" %>
            </div>
            <% if @lastfm_recent['album']['content'].present? %>
              <div x-on:click="window.open('<%= @lastfm_recent["album"]["url"] %>')" class="text-[#e5ded3] italic text-xl hover:underline line-clamp-1 break-all cursor-pointer">
                <%= "#{@lastfm_recent['album']['content']}" %>
              </div>
            <% end %>
            <% if @lastfm_recent['nowplaying'].blank? %>
              <div>
                <div x-on:click="window.open('https://www.last.fm/user/aldwin7894/library')" class="hover:underline line-clamp-1 text-lg break-all cursor-pointer">
                  last played
                  <% if time_ago_in_words(Time.zone.at(@lastfm_recent['date']['uts'].to_i)) == 'less than a minute' %>
                    just now
                  <% else %>
                    <%= (time_ago_in_words(Time.zone.at(@lastfm_recent["date"]["uts"].to_i)) + " ago").sub("about", "") %>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="flex flex-col text-center">
            <div class="text-[#3cb4f1] text-3xl font-bold line-clamp-2 break-words">
              LAST.FM IS CURRENTLY DOWN!!
            </div>
            <div class="line-clamp-1 text-2xl">
              ¯\(ツ)/¯
            </div>
            <div class="text-[#e5ded3] italic text-xl line-clamp-1 break-all">
              as always lol
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</turbo-frame>
